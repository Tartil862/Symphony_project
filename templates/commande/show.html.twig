{% extends 'base.html.twig' %}

{% block title %}{{ 'order.order_number'|trans }} #{{ commande.id }}{% endblock %}
{% block page_title %}ðŸ“‹ {{ 'order.order_number'|trans }} #{{ commande.id }}{% endblock %}

{% block stylesheets %}
<style>
    .order-detail-container {
        max-width: 900px;
        margin: 0 auto;
    }

    .order-header {
        background: linear-gradient(135deg, #1f2c2e, #2A3638, #4a6264);
        border-radius: 1.2rem;
        padding: 2rem;
        color: #fff;
        margin-bottom: 1.5rem;
        position: relative;
        overflow: hidden;
    }
    .order-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -10%;
        width: 300px;
        height: 300px;
        background: rgba(255,255,255,.05);
        border-radius: 50%;
    }
    .order-header::after {
        content: '';
        position: absolute;
        bottom: -40%;
        left: -5%;
        width: 200px;
        height: 200px;
        background: rgba(255,255,255,.03);
        border-radius: 50%;
    }

    .order-header-title {
        font-size: 1.5rem;
        font-weight: 800;
        margin-bottom: .5rem;
        position: relative;
        z-index: 1;
    }
    .order-header-meta {
        display: flex;
        gap: 1.5rem;
        flex-wrap: wrap;
        position: relative;
        z-index: 1;
    }
    .order-header-meta span {
        font-size: .85rem;
        opacity: .85;
        display: flex;
        align-items: center;
        gap: .4rem;
    }

    .order-status-badge {
        display: inline-flex;
        align-items: center;
        gap: .3rem;
        padding: .4rem 1rem;
        border-radius: 999px;
        font-size: .78rem;
        font-weight: 700;
        position: relative;
        z-index: 1;
    }
    .order-status-en-attente {
        background: rgba(251,191,36,.25);
        color: #fde68a;
    }
    .order-status-confirmee {
        background: rgba(16,185,129,.25);
        color: #a7f3d0;
    }
    .order-status-livree {
        background: rgba(96,165,250,.25);
        color: #bfdbfe;
    }

    .ligne-card {
        display: flex;
        align-items: center;
        gap: 1.2rem;
        padding: 1.1rem 1.3rem;
        background: #fff;
        border-radius: 1rem;
        margin-bottom: .7rem;
        box-shadow: 0 2px 8px rgba(0,0,0,.04);
        transition: all .3s cubic-bezier(.4,0,.2,1);
        animation: fadeSlideUp .4s ease;
    }
    .ligne-card:hover {
        box-shadow: 0 8px 24px rgba(42,54,56,.08);
        transform: translateX(4px);
    }

    .ligne-img {
        width: 65px;
        height: 65px;
        border-radius: .7rem;
        object-fit: cover;
        flex-shrink: 0;
    }
    .ligne-placeholder {
        width: 65px;
        height: 65px;
        border-radius: .7rem;
        background: linear-gradient(135deg, #f5f0ea, #efe8df);
        display: grid;
        place-items: center;
        color: #E5C6A4;
        font-size: 1.3rem;
        flex-shrink: 0;
    }

    .ligne-info {
        flex: 1;
        min-width: 0;
    }
    .ligne-name {
        font-weight: 700;
        color: #1e293b;
        font-size: .95rem;
    }
    .ligne-unit-price {
        font-size: .78rem;
        color: #94a3b8;
    }

    .ligne-qty {
        background: linear-gradient(135deg, #e8f0e9, #dde8de);
        color: #2A3638;
        padding: .3rem .7rem;
        border-radius: .5rem;
        font-weight: 700;
        font-size: .82rem;
    }

    .ligne-subtotal {
        font-weight: 800;
        color: #2A3638;
        font-size: 1rem;
        min-width: 85px;
        text-align: right;
    }

    .order-total-card {
        background: linear-gradient(135deg, #FAF6F1, #fefefe);
        border-radius: 1rem;
        padding: 1.5rem;
        margin-top: 1rem;
        box-shadow: 0 2px 12px rgba(0,0,0,.06);
    }
    .order-total-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .order-total-label {
        font-size: 1.1rem;
        font-weight: 700;
        color: #1e293b;
    }
    .order-total-value {
        font-size: 1.6rem;
        font-weight: 800;
        background: linear-gradient(135deg, #E54A5F, #F1947C);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .back-link {
        display: inline-flex;
        align-items: center;
        gap: .4rem;
        color: #2A3638;
        text-decoration: none;
        font-weight: 600;
        font-size: .9rem;
        transition: all .3s ease;
        margin-top: 1.2rem;
    }
    .back-link:hover {
        color: #1f2c2e;
        transform: translateX(-4px);
    }

    .section-label {
        font-size: .85rem;
        font-weight: 700;
        color: #91B893;
        text-transform: uppercase;
        letter-spacing: .06em;
        margin-bottom: .8rem;
        display: flex;
        align-items: center;
        gap: .4rem;
    }
</style>
{% endblock %}

{% block body %}
    <div class="order-detail-container">
        {# Order Header #}
        <div class="order-header">
            <div class="d-flex align-items-start justify-content-between flex-wrap gap-2">
                <div>
                    <div class="order-header-title">{{ 'order.order_number'|trans }} #{{ commande.id }}</div>
                    <div class="order-header-meta">
                        <span><i class="bi bi-calendar3"></i> {{ commande.createdAt|date('d/m/Y Ã  H:i') }}</span>
                        <span><i class="bi bi-person"></i> {{ commande.user.prenom ?? '' }} {{ commande.user.nom ?? '' }}</span>
                        <span><i class="bi bi-box"></i> {{ commande.ligneCommandes|length }} article{{ commande.ligneCommandes|length > 1 ? 's' : '' }}</span>
                    </div>
                </div>
                <span class="order-status-badge {% if commande.status == 'En attente' %}order-status-en-attente{% elseif commande.status == 'ConfirmÃ©e' %}order-status-confirmee{% else %}order-status-livree{% endif %}">
                    <i class="bi bi-{% if commande.status == 'En attente' %}clock{% elseif commande.status == 'ConfirmÃ©e' %}check-circle{% else %}truck{% endif %}"></i>
                    {{ commande.status }}
                </span>
            </div>
        </div>

        {# Lignes de commande #}
        <div class="section-label">
            <i class="bi bi-list-check"></i> {{ 'order.order_lines'|trans }}
        </div>

        {% for ligne in commande.ligneCommandes %}
            <div class="ligne-card">
                {% if ligne.product.image %}
                    <img src="{{ asset(ligne.product.imageFolder ~ '/' ~ ligne.product.image) }}" alt="{{ ligne.product.label }}" class="ligne-img">
                {% else %}
                    <div class="ligne-placeholder">
                        <i class="bi bi-image"></i>
                    </div>
                {% endif %}

                <div class="ligne-info">
                    <div class="ligne-name">{{ ligne.product.label }}</div>
                    <div class="ligne-unit-price">{{ ligne.prix|number_format(2, '.', ',') }} DT / {{ 'order.unit_price'|trans }}</div>
                </div>

                <span class="ligne-qty">Ã— {{ ligne.quantity }}</span>

                <div class="ligne-subtotal">{{ ligne.subtotal|number_format(2, '.', ',') }} DT</div>
            </div>
        {% endfor %}

        {# Total #}
        <div class="order-total-card">
            {% if commande.discountRate %}
                <div class="order-total-row mb-2">
                    <span style="font-size:.95rem;color:#64748b;">{{ 'order.subtotal'|trans }}</span>
                    <span style="font-size:1rem;color:#64748b;font-weight:500;">
                        {% set baseTotal = commande.total + commande.discountAmount %}
                        {{ baseTotal|number_format(2, '.', ',') }} DT
                    </span>
                </div>
                <div class="order-total-row mb-2" style="align-items:center;">
                    <span style="font-size:.95rem;color:#16a34a;font-weight:600;display:flex;align-items:center;gap:.4rem;">
                        {% if commande.couponCode %}
                            <i class="bi bi-ticket-perforated-fill"></i>
                            {{ 'order.coupon_applied'|trans({'%rate%': (commande.discountRate * 100)|round}) }}
                            <code style="background:#dcfce7;color:#166534;padding:.15rem .5rem;border-radius:.3rem;font-size:.78rem;font-weight:700;">{{ commande.couponCode }}</code>
                        {% else %}
                            <i class="bi bi-award-fill"></i>
                            {{ 'order.discount_applied'|trans({'%rate%': (commande.discountRate * 100)|round}) }}
                        {% endif %}
                    </span>
                    <span style="font-size:1rem;color:#16a34a;font-weight:700;">âˆ’ {{ commande.discountAmount|number_format(2, '.', ',') }} DT</span>
                </div>
                <hr style="border-color:#efe8df;margin:.6rem 0">
            {% endif %}
            <div class="order-total-row">
                <span class="order-total-label"><i class="bi bi-receipt"></i> {{ 'order.order_total'|trans }}</span>
                <span class="order-total-value">{{ commande.total|number_format(2, '.', ',') }} DT</span>
            </div>
        </div>

        <a href="{{ path('app_commande_index') }}" class="back-link">
            <i class="bi bi-arrow-left"></i> {{ 'order.back_to_orders'|trans }}
        </a>
    </div>
{% endblock %}
