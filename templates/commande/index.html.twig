{% extends 'base.html.twig' %}

{% block title %}{{ 'order.title'|trans }}{% endblock %}
{% block page_title %}ðŸ“¦ {{ 'order.title'|trans }}{% endblock %}

{% block stylesheets %}
<style>
    .commande-card {
        background: #fff;
        border-radius: 1rem;
        padding: 1.3rem 1.5rem;
        margin-bottom: .8rem;
        box-shadow: 0 2px 8px rgba(0,0,0,.04);
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: all .3s cubic-bezier(.4,0,.2,1);
        animation: fadeSlideUp .4s ease;
        text-decoration: none;
        color: inherit;
    }
    .commande-card:hover {
        box-shadow: 0 8px 24px rgba(42,54,56,.1);
        transform: translateX(6px);
        color: inherit;
    }

    .commande-id {
        font-weight: 800;
        font-size: 1.1rem;
        color: #2A3638;
    }

    .commande-date {
        font-size: .82rem;
        color: #94a3b8;
        display: flex;
        align-items: center;
        gap: .3rem;
    }

    .commande-status {
        padding: .35rem .85rem;
        border-radius: 999px;
        font-size: .72rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: .04em;
    }
    .status-en-attente {
        background: linear-gradient(135deg, #fef3c7, #fde68a);
        color: #92400e;
    }
    .status-confirmee {
        background: linear-gradient(135deg, #dde8de, #c5dcc7);
        color: #065f46;
    }
    .status-livree {
        background: linear-gradient(135deg, #e8dfd5, #ddd0bf);
        color: #1e40af;
    }

    .commande-total {
        font-weight: 800;
        font-size: 1.15rem;
        background: linear-gradient(135deg, #E54A5F, #F1947C);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .commande-items-count {
        font-size: .78rem;
        color: #64748b;
        display: flex;
        align-items: center;
        gap: .3rem;
    }

    .commande-arrow {
        color: #E5C6A4;
        font-size: 1.2rem;
        transition: transform .3s var(--transition-bounce);
    }
    .commande-card:hover .commande-arrow {
        transform: translateX(4px);
        color: #2A3638;
    }

    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
    }
    .empty-state i {
        font-size: 5rem;
        color: #ddd0bf;
        margin-bottom: 1rem;
    }
    .empty-state h4 {
        color: #64748b;
        font-weight: 600;
    }
    .empty-state p {
        color: #94a3b8;
    }

    .flash-toast {
        position: fixed;
        top: 80px;
        right: 2rem;
        z-index: 9999;
        animation: slideInRight .4s cubic-bezier(.4,0,.2,1);
    }
    @keyframes slideInRight {
        from { opacity: 0; transform: translateX(40px); }
        to   { opacity: 1; transform: translateX(0); }
    }
</style>
{% endblock %}

{% block body %}
    {# Flash messages #}
    {% for type, messages in app.flashes %}
        {% for message in messages %}
            <div class="flash-toast">
                <div class="alert alert-{{ type == 'success' ? 'success' : (type == 'warning' ? 'warning' : 'info') }} alert-dismissible fade show d-flex align-items-center gap-2" style="border-radius:.8rem;border:none;box-shadow:0 8px 25px rgba(0,0,0,.1)">
                    <i class="bi bi-{{ type == 'success' ? 'check-circle-fill' : 'info-circle-fill' }}"></i>
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            </div>
        {% endfor %}
    {% endfor %}

    {% if commandes is empty %}
        <div class="empty-state">
            <i class="bi bi-bag-x"></i>
            <h4>{{ 'order.no_order_yet'|trans }}</h4>
            <p>{{ 'order.no_orders'|trans }}</p>
            <a href="{{ path('app_dashboard') }}" class="btn-accent mt-3 d-inline-flex align-items-center gap-2">
                <i class="bi bi-shop"></i> {{ 'order.explore_shop'|trans }}
            </a>
        </div>
    {% else %}
        <div class="d-flex align-items-center justify-content-between mb-3">
            <h5 style="font-weight:700;color:#2A3638;margin:0">
                <i class="bi bi-receipt"></i> {{ commandes|length }} commande{{ commandes|length > 1 ? 's' : '' }}
            </h5>
            <a href="{{ path('app_dashboard') }}" class="btn-outline-accent">
                <i class="bi bi-shop"></i> {{ 'order.shop'|trans }}
            </a>
        </div>

        {% for commande in commandes %}
            <a href="{{ path('app_commande_show', {id: commande.id}) }}" class="commande-card">
                <div>
                    <div class="commande-id">{{ 'order.order_number'|trans }} #{{ commande.id }}</div>
                    <div class="commande-date">
                        <i class="bi bi-calendar3"></i> {{ commande.createdAt|date('d/m/Y Ã  H:i') }}
                    </div>
                    <div class="commande-items-count mt-1">
                        <i class="bi bi-box"></i> {{ commande.ligneCommandes|length }} article{{ commande.ligneCommandes|length > 1 ? 's' : '' }}
                    </div>
                </div>
                <div class="d-flex align-items-center gap-3">
                    <span class="commande-status {% if commande.status == 'En attente' %}status-en-attente{% elseif commande.status == 'ConfirmÃ©e' %}status-confirmee{% else %}status-livree{% endif %}">
                        {{ commande.status }}
                    </span>
                    <div class="commande-total">{{ commande.total|number_format(2, '.', ',') }} DT</div>
                    <i class="bi bi-chevron-right commande-arrow"></i>
                </div>
            </a>
        {% endfor %}
    {% endif %}
{% endblock %}

{% block javascripts %}
<script>
    setTimeout(() => {
        document.querySelectorAll('.flash-toast .alert').forEach(el => {
            const bsAlert = bootstrap.Alert.getOrCreateInstance(el);
            bsAlert.close();
        });
    }, 3000);
</script>
{% endblock %}
